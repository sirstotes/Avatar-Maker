<!DOCTYPE html>
<html>
    <head>
        <title>OpenAvi</title>
        <link type="text/css" rel="stylesheet" href="style.css">
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/p5.min.js"></script>
        <script type="text/javascript" src="transformer.js"></script>
        <script type="text/javascript" src="options.js"></script>
        <script type="text/javascript" src="buffers.js"></script>
        <script type="text/javascript" src="image.js"></script>
        <script type="text/javascript" src="element_container.js"></script>
        <script type="text/javascript" src="element.js"></script>
        <script type="text/javascript" src="maker.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div id="workspace">
            <div id="canvas">
                <div id="controls_position">
                    <div id="movement_controls" class="controls_container" hidden>
                        <div class="controls">
                            <button onclick="hideMovementControls(true);" id="move_check" style="background-color: var(--button-confirm-color);"><img class="icon" src="assets/check.png" style="filter:invert(1);"></button>
                            <button class="extrude translation" onclick="moveElement(0, -1);"><img class="icon" src="assets/up.png"></button>
                            <button class="extrude translation" onclick="moveElement(0, 1);"><img class="icon" src="assets/down.png"></button>
                            <button class="extrude translation" onclick="moveElement(-1, 0);"><img class="icon" src="assets/left.png"></button>
                            <button class="extrude translation" onclick="moveElement(1, 0);"><img class="icon" src="assets/right.png"></button>
                            <button class="extrude rotation" onclick="rotateElement(-1);"><img class="icon" src="assets/counterclockwise.png"></button>
                            <button class="extrude rotation" onclick="rotateElement(1);"><img class="icon" src="assets/clockwise.png"></button>
                            <button class="extrude scale" onclick="scaleElement(1, 1);"><img class="icon" src="assets/bigger.png"></button>
                            <button class="extrude scale" onclick="scaleElement(-1, -1);"><img class="icon" src="assets/smaller.png"></button>
                        </div>
                    </div>
                    <div id="color_controls" class="controls_container" hidden>
                        <div class="controls">
                            <div id="palette_container"></div>
                            <button class="extrude" onclick="hideColorControls(true);" style="background-color: var(--button-confirm-color);"><img class="icon" src="assets/check.png" style="filter:invert(1);"></button>
                            <button class="extrude" onclick="removeSelectedColor();"><img class="icon" src="assets/delete.png"></button>
                            <button class="extrude" onclick="showColorPicker();"><img class="icon" src="assets/plus.png"></button>
                        </div>
                    </div>
                    <div id="color_picker" class="controls_container" hidden>
                        <div class="controls">
                            <input oninput="updateSelectedColor(true);" type="text" value="#FFFFFF" id="color_preview"></input>
                            <input oninput="updateSelectedColor();" type="range" id="color_picker_hue" min="0" max="360"><br>
                            <input oninput="updateSelectedColor();" type="range" id="color_picker_saturation" min="0" max="100"><br>
                            <input oninput="updateSelectedColor();" type="range" id="color_picker_lightness" min="0" max="100"><br>
                            <button class="extrude" onclick="hideColorPicker(true);hideColorControls(true);" style="background-color: var(--button-confirm-color);"><img class="icon" src="assets/check.png" style="filter:invert(1);"></button>
                            <button class="extrude" onclick="hideColorPicker(false);hideColorControls(false);" style="background-color: var(--button-cancel-color);"><img class="icon" src="assets/cancel.png" style="filter:invert(1);"></button>
                        </div>
                    </div>
                </div>
                <div id="canvas_area">
                    <div id="canvas_container">
                    </div>
                    <div id="bottom_controls">
                        <button class="extrude" onclick="showMakerSelectPopup();"><img class="icon" src="assets/browser.png"></button>
                        <button class="extrude" onclick="saveCanvas();"><img class="icon" src="assets/save.png"></button>
                        <button class="extrude" onclick="tryReset(this);"><img class="icon" src="assets/refresh.png"></button>
                        <button class="extrude" onclick="showElementExportPopup();"><img class="icon" src="assets/notes.png"></button>
                    </div>
                </div>
            </div>
            <div id="elements">
            </div>
        </div>
        <div id="popup" style="display:none;">
            <div id="element_select" hidden="true">
                <div id="selectable_elements"></div>
                <button id="element_select_cancel" class="extrude" onclick="clearExtraCanvases();hidePopups();" style="background-color: var(--button-cancel-color);"><img class="icon" src="assets/cancel.png" style="filter:invert(1);"></button>
            </div>
            <div id="element_export" hidden="true">
                <h3>Below is the save file for your image. Load a save file by pasting into the text box and pressing <img class="tiny_icon" src="assets/upload.png"></h3>
                <textarea id="export_json" rows="30" type="text"></textarea>
                <br>
                <button class="extrude" onclick="copyChanges(this);"><img class="icon" src="assets/clone.png"></button>
                <button class="extrude" onclick="downloadChanges();"><img class="icon" src="assets/download.png"></button>
                <button class="extrude" onclick="loadChanges(document.getElementById('export_json').value);hidePopups();"><img class="icon" src="assets/upload.png"></button>
                <button class="extrude" onclick="hidePopups();" style="background-color: var(--button-cancel-color);"><img class="icon" src="assets/cancel.png" style="filter:invert(1);"></button>
            </div>
            <div id="maker_select" hidden="true">
                <h2>Pack Load</h2>
                <p>Provide a pack URL in the area below. Example urls include "examplePack/" and "https://open-avi-chibi-pack.netlify.app/"</p>
                <p>WARNING: All current changes will be deleted.</p>
                <input id="maker_url" type="text" value="https://open-avi-chibi-pack.netlify.app/">
                <button class="extrude" onclick="tryLoadPack();hidePopups();" style="background-color: var(--button-confirm-color);"><img class="icon" src="assets/check.png" style="filter:invert(1);"></button>
                <button class="extrude" onclick="hidePopups();" style="background-color: var(--button-cancel-color);"><img class="icon" src="assets/cancel.png" style="filter:invert(1);"></button>
            </div>
            <div id="pack_confirmation" hidden="true">
                <h2 id="pack_confirmation_name">Pack Name</h2>
                <img id="pack_confirmation_img">
                <p id="pack_confirmation_description">Pack description</p>
                <button id="pack_confirmation_button" class="extrude" onclick="" style="background-color: var(--button-confirm-color);"><img class="icon" src="assets/check.png" style="filter:invert(1);"></button>
                <button class="extrude" onclick="hidePopups();" style="background-color: var(--button-cancel-color);"><img class="icon" src="assets/cancel.png" style="filter:invert(1);"></button>
            </div>
            <div id="explanation" hidden="true" style="text-align: left;background-color: var(--button-color);">
                <h2>OpenAvi v0.5</h2>
                <p>Welcome to OpenAvi, a work-in-progress open-source alternative to <a href="https://picrew.me/">picrew</a>. OpenAvi started development in October of 2025. Some unique features of OpenAvi include:</p>
                <ul>
                    <li>Image recoloring and custom colors</li>
                    <li>Image clipping/decals</li>
                    <li>Multi-layered image objects</li>
                    <li>Saveable creations in the form of JSON files</li>
                    <li>Open-source framework and pack hosting</li>
                    <li>Duplicating objects, changing layer order, and free movement of objects</li>
                    <li>Highly customizable JSON files for pack creation</li>
                </ul>
                <p>Some features I plan to add in the future include:</p>
                <ul>
                    <li>Pack creation tutorial (Coming soon!)</li>
                    <li>Blend modes (multiply, subtract, lighten etc)</li>
                    <li>Drawing tool for even more customizabile decals</li>
                    <li>Uploading images for decals or use in objects (i.e. you could upload an image to be used as a tattoo on an avatar)</li>
                    <li>Pack selection/sharing hub</li>
                    <li>Pack creation tool</li>
                    <li>Undo button</li>
                    <li>Eyedrop tool</li>
                </ul>
                <p>If you encounter any bugs, please submit them to <a href="https://github.com/sirstotes/Avatar-Maker">the github</a>.</p>
                <h3>Credits</h3>
                OpenAvi is Copyright (c) 2025 Isaiah Stotesbery under <a href="https://choosealicense.com/licenses/gpl-3.0/">GNU GPLv3</a><br>
                Individual packs may have their own copyright according to the wishes of pack creators<br>
                <a href="https://www.flaticon.com/authors/icon-mania" title="icons">Icons created by Icon Mania and Freepik - Flaticon</a><br>
                <a href="https://maellemarylloup.itch.io/" title="assets">Example assets created by MaelleMarylloup - Itch.io</a><br><br>
                <button class="extrude" onclick="hidePopups();" style="background-color: var(--button-confirm-color);"><img class="icon" src="assets/check.png" style="filter:invert(1);"></button>
            </div>
        </div>
        <h1 onclick="showPopup('explanation')" style="cursor:pointer;">OpenAvi<span style="font-size:0.5em;">v0.5</span></h1>
    </body>
</html>
